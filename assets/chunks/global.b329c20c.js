import{z as d,k as m,D as v,B as f}from"./floating-ui.dom.browser.min.5c826213.js";const y={target:"body",api:"qcc_openapi",queryDelay:500,placeholder:"请输入企业名称或统一社会信用代码",clearable:!0,clearIcon:'<svg viewBox="64 64 896 896" focusable="false" data-icon="close-circle" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm165.4 618.2l-66-.3L512 563.4l-99.3 118.4-66.1.3c-4.4 0-8-3.5-8-8 0-1.9.7-3.7 1.9-5.2l130.1-155L340.5 359a8.32 8.32 0 01-1.9-5.2c0-4.4 3.6-8 8-8l66.1.3L512 464.6l99.3-118.4 66-.3c4.4 0 8 3.5 8 8 0 1.9-.7 3.7-1.9 5.2L553.5 514l130 155c1.2 1.5 1.9 3.3 1.9 5.2 0 4.4-3.6 8-8 8z"></path></svg>',fetchCallback:()=>{}},E=n=>typeof n=="string",C=(n,s,t)=>p(t||s,"{keyword}",n),h=async(n,s)=>{for(const t of s)try{const i=p(t,"{id}",n),e=await fetch(i);if(e.status===200){const a=await e.blob();return URL.createObjectURL(a)}}catch(i){console.error(i)}return""},p=(n,s,t)=>n.replace(new RegExp(s,"g"),t);function L(n,s=0,{start:t=!0,middle:i=!0,once:e=!1}={}){let a=t,o=0,r,u=!1;function c(...g){if(u)return;const l=Date.now()-o;o=Date.now(),t&&i&&l>=s&&(a=!0),a?(a=!1,n.apply(this,g),e&&c.cancel()):(i&&l<s||!i)&&(clearTimeout(r),r=setTimeout(()=>{o=Date.now(),n.apply(this,g),e&&c.cancel()},i?s-l:s))}return c.cancel=()=>{clearTimeout(r),u=!0},c}function S(n,s=0,{start:t=!1,middle:i=!1,once:e=!1}={}){return L(n,s,{start:t,middle:i,once:e})}const _="https://c.qcc.com/embed/api/company/getCompanyName?searchKey={keyword}",b=async(n,s)=>{switch(s.api){case"qcc_openapi":return await w(n,s);default:return[]}},w=async(n,s)=>{if(n.length<2)return[];const t=C(n,_,s.searchUrl),e=await(await fetch(t,{method:"GET",mode:"cors",headers:{Referer:"https://c.qcc.com/"}})).json(),a=[];return e.status!=="200"?a:e.result.map(o=>({name:o.companyName,id:o.keyNo}))},W=(n,s)=>{let t=!1;document.addEventListener("click",i=>{!n.contains(i.target)&&!t&&s(),t=n.contains(i.target)},!0)},q=["https://image.qcc.com/logo/{id}.jpg","https://image.qcc.com/auto/{id}.jpg"],x=async(n,s)=>{const t=n.dataset.id||"";if(s.avatarUrl){n.src=await h(t,[s.avatarUrl]);return}switch(s.api){case"qcc_openapi":n.src=await h(t,q);break}};class N{constructor(s={}){this.suggestions=[],this.suggestionElement=document.createElement("div"),this.suggestionActivatedClassName="suggestion-popper--activated",this.inputWrapElement=document.createElement("div"),this.inputWrapHaveWordsClassName="company-autocomplete--words",this.inputWrapActivatedClassName="company-autocomplete--activated",this.options=Object.assign({},y,s),E(this.options.target)?this.target=document.querySelector(this.options.target):this.target=this.options.target,this.render()}render(){var i;if(!this.target)return;const s=['<div class="company-autocomplete">','<div class="company-autocomplete__input">',`<input type="text" placeholder="${this.options.placeholder}" />`,"</div>",this.options.clearable&&`<div class="company-autocomplete__clear">${this.options.clearIcon}</div>`,"</div>"];this.target.innerHTML=s.join(""),this.suggestionElement.classList.add("suggestion-popper"),this.suggestionElement.textContent="",document.body.appendChild(this.suggestionElement),this.inputWrapElement=this.target.querySelector(".company-autocomplete");const t=this.inputWrapElement.querySelector("input");d(this.inputWrapElement,this.suggestionElement,()=>{m(this.inputWrapElement,this.suggestionElement,{middleware:[v(5),f({apply:({rects:e})=>{Object.assign(this.suggestionElement.style,{width:`${e.reference.width}px`})}})]}).then(({x:e,y:a})=>{Object.assign(this.suggestionElement.style,{left:`${e}px`,top:`${a}px`})})}),t==null||t.addEventListener("input",()=>{const e=t.value;this.inputWrapElement.classList[e.length>0?"add":"remove"](this.inputWrapHaveWordsClassName),e.length===0&&this.hideSuggestion()}),t==null||t.addEventListener("input",S(()=>{const e=t.value;this.handleQuerySuggestion(e)},this.options.queryDelay)),t==null||t.addEventListener("click",e=>{if(this.suggestions.length>0){this.showSuggestion();return}const a=e.target.value;this.handleQuerySuggestion(a)}),W(this.suggestionElement,()=>{this.hideSuggestion()}),this.suggestionElement.addEventListener("click",e=>{var a;if(e.target.closest(".suggestion")){const o=(a=e.target.closest(".suggestion"))==null?void 0:a.querySelector(".suggestion__label"),r=(o==null?void 0:o.textContent)||"";t.value=r,this.suggestions=[],this.options.fetchCallback(r),this.hideSuggestion()}}),this.inputClearElement=this.inputWrapElement.querySelector(".company-autocomplete__clear"),this.inputClearElement&&((i=this.inputClearElement)==null||i.addEventListener("click",()=>{t.value="",this.suggestionElement.textContent="",this.inputWrapElement.classList.remove(this.inputWrapHaveWordsClassName)}))}handleQuerySuggestion(s){b(s,this.options).then(t=>{if(this.suggestions=t,t.length===0){this.suggestionElement.textContent="",this.hideSuggestion();return}const i=['<div class="suggestion-popper__body">'];t.forEach(e=>{i.push('<div class="suggestion">'),i.push(`<div class="suggestion__avatar"><img data-id="${e.id}" alt="${e.name}"/></div>`),i.push(`<div class="suggestion__label">${e.name}</div>`),i.push('<div class="suggestion__extra"></div>'),i.push("</div>")}),i.push("</div>"),i.push('<div class="suggestion-popper__footer">'),i.push("</div>"),this.suggestionElement.innerHTML=i.join(""),this.suggestionElement.querySelectorAll("img").forEach(e=>{x(e,this.options)}),this.showSuggestion()})}showSuggestion(){this.inputWrapElement.classList.add(this.inputWrapActivatedClassName),this.suggestionElement.classList.add(this.suggestionActivatedClassName)}hideSuggestion(){this.inputWrapElement.classList.remove(this.inputWrapActivatedClassName),this.suggestionElement.classList.remove(this.suggestionActivatedClassName)}}export{N as C};
