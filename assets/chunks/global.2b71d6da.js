import{z as p,k as h,D as d,B as m}from"./floating-ui.dom.browser.min.5c826213.js";const f={target:"body",api:"qcc_openapi",queryDelay:500,placeholder:"请输入企业名称或统一社会信用代码",clearable:!0,clearIcon:'<svg viewBox="64 64 896 896" focusable="false" data-icon="close-circle" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm165.4 618.2l-66-.3L512 563.4l-99.3 118.4-66.1.3c-4.4 0-8-3.5-8-8 0-1.9.7-3.7 1.9-5.2l130.1-155L340.5 359a8.32 8.32 0 01-1.9-5.2c0-4.4 3.6-8 8-8l66.1.3L512 464.6l99.3-118.4 66-.3c4.4 0 8 3.5 8 8 0 1.9-.7 3.7-1.9 5.2L553.5 514l130 155c1.2 1.5 1.9 3.3 1.9 5.2 0 4.4-3.6 8-8 8z"></path></svg>',fetchCallback:()=>{}},v=n=>typeof n=="string";function y(n,i=0,{start:e=!0,middle:s=!0,once:t=!1}={}){let a=e,o=0,l,u=!1;function c(...g){if(u)return;const r=Date.now()-o;o=Date.now(),e&&s&&r>=i&&(a=!0),a?(a=!1,n.apply(this,g),t&&c.cancel()):(s&&r<i||!s)&&(clearTimeout(l),l=setTimeout(()=>{o=Date.now(),n.apply(this,g),t&&c.cancel()},s?i-r:i))}return c.cancel=()=>{clearTimeout(l),u=!0},c}function E(n,i=0,{start:e=!1,middle:s=!1,once:t=!1}={}){return y(n,i,{start:e,middle:s,once:t})}const C=async(n,i)=>{switch(n){case"qcc_openapi":return await L(i);default:return[]}},L=async n=>(console.log(n),n.length<2?[]:{status:"200",result:[{companyName:"企查查科技有限公司",keyNo:"f625a5b661058ba5082ca508f99ffe1b"},{companyName:"石狮市青创城电子商务园区有限责任公司",keyNo:"af153062144625f2f82f1d2eae9bbe06"},{companyName:"上海东龙服饰有限公司",keyNo:"68d931176fdd2e44b229d8ff1f34652f"},{companyName:"深圳振强生物技术有限公司",keyNo:"106073d8ae22ce77d5159ce4cd657efc"},{companyName:"西安开天传动技术有限公司",keyNo:"36e4ed7802454db0df12a9cef26ea423"}]}.result.map(e=>({name:e.companyName,id:e.keyNo}))),N=(n,i)=>{let e=!1;document.addEventListener("click",s=>{!n.contains(s.target)&&!e&&i(),e=n.contains(s.target)},!0)};class _{constructor(i={}){this.suggestions=[],this.suggestionElement=document.createElement("div"),this.suggestionActivatedClassName="suggestion-popper--activated",this.inputWrapElement=document.createElement("div"),this.inputWrapHaveWordsClassName="company-autocomplete--words",this.inputWrapActivatedClassName="company-autocomplete--activated",this.options=Object.assign({},f,i),v(this.options.target)?this.target=document.querySelector(this.options.target):this.target=this.options.target,this.render()}render(){var s;if(!this.target)return;const i=['<div class="company-autocomplete">','<div class="company-autocomplete__input">',`<input type="text" placeholder="${this.options.placeholder}" />`,"</div>",this.options.clearable&&`<div class="company-autocomplete__clear">${this.options.clearIcon}</div>`,"</div>"];this.target.innerHTML=i.join(""),this.suggestionElement.classList.add("suggestion-popper"),this.suggestionElement.textContent="",document.body.appendChild(this.suggestionElement),this.inputWrapElement=this.target.querySelector(".company-autocomplete");const e=this.inputWrapElement.querySelector("input");p(this.inputWrapElement,this.suggestionElement,()=>{h(this.inputWrapElement,this.suggestionElement,{middleware:[d(5),m({apply:({rects:t})=>{Object.assign(this.suggestionElement.style,{width:`${t.reference.width}px`})}})]}).then(({x:t,y:a})=>{Object.assign(this.suggestionElement.style,{left:`${t}px`,top:`${a}px`})})}),e==null||e.addEventListener("input",()=>{const t=e.value;this.inputWrapElement.classList[t.length>0?"add":"remove"](this.inputWrapHaveWordsClassName)}),e==null||e.addEventListener("input",E(()=>{const t=e.value;this.handleQuerySuggestion(t)},this.options.queryDelay)),e==null||e.addEventListener("click",t=>{if(this.suggestions.length>0){this.showSuggestion();return}const a=t.target.value;this.handleQuerySuggestion(a)}),N(this.suggestionElement,()=>{this.hideSuggestion()}),this.suggestionElement.addEventListener("click",t=>{var a;if(t.target.closest(".suggestion")){const o=(a=t.target.closest(".suggestion"))==null?void 0:a.querySelector(".suggestion__label"),l=(o==null?void 0:o.textContent)||"";e.value=l,this.suggestions=[],this.options.fetchCallback(l),this.hideSuggestion()}}),this.inputClearElement=this.inputWrapElement.querySelector(".company-autocomplete__clear"),this.inputClearElement&&((s=this.inputClearElement)==null||s.addEventListener("click",()=>{e.value="",this.inputWrapElement.classList.remove(this.inputWrapHaveWordsClassName)}))}handleQuerySuggestion(i){C(this.options.api,i).then(e=>{if(this.suggestions=e,e.length===0){this.suggestionElement.innerHTML="",this.hideSuggestion();return}const s=['<div class="suggestion-popper__body">'];e.forEach(t=>{s.push('<div class="suggestion">'),s.push(`<div class="suggestion__avatar"><img data-suggestion-id="${t.id}" src="https://image.qcc.com/logo/${t.id}.jpg" alt="${t.name}"/></div>`),s.push(`<div class="suggestion__label">${t.name}</div>`),s.push('<div class="suggestion__extra"></div>'),s.push("</div>")}),s.push("</div>"),s.push('<div class="suggestion-popper__footer">'),s.push("</div>"),this.suggestionElement.innerHTML=s.join(""),this.suggestionElement.querySelectorAll("img").forEach(t=>{t.addEventListener("error",function(){this.src=`https://image.qcc.com/auto/${this.dataset.suggestionId}.jpg`})}),this.showSuggestion()})}showSuggestion(){this.inputWrapElement.classList.add(this.inputWrapActivatedClassName),this.suggestionElement.classList.add(this.suggestionActivatedClassName)}hideSuggestion(){this.inputWrapElement.classList.remove(this.inputWrapActivatedClassName),this.suggestionElement.classList.remove(this.suggestionActivatedClassName)}}export{_ as C};
