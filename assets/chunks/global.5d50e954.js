import{B as y,N as v,L as f,C as b,A as S}from"./floating-ui.dom.browser.min.6e57e80d.js";const k={target:"body",api:"qcc_openapi",queryDelay:500,placeholder:"请输入企业名称或统一社会信用代码",clearable:!0,clearIcon:'<svg viewBox="64 64 896 896" focusable="false" data-icon="close-circle" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm165.4 618.2l-66-.3L512 563.4l-99.3 118.4-66.1.3c-4.4 0-8-3.5-8-8 0-1.9.7-3.7 1.9-5.2l130.1-155L340.5 359a8.32 8.32 0 01-1.9-5.2c0-4.4 3.6-8 8-8l66.1.3L512 464.6l99.3-118.4 66-.3c4.4 0 8 3.5 8 8 0 1.9-.7 3.7-1.9 5.2L553.5 514l130 155c1.2 1.5 1.9 3.3 1.9 5.2 0 4.4-3.6 8-8 8z"></path></svg>',autoFocus:!0,history:{enabled:!0,type:"localStorage",key:"company-history",showClear:!0},onFetch:()=>{},onSelect:()=>{},onClear:()=>{},showSubmitButton:!0,submitButtonLabel:"Submit",offsetTop:5,autoFlip:!1,submitCallback:()=>{}},w=(s,t)=>{if(!t.enabled||!t.key)return;const e=t.type==="localStorage"?localStorage:sessionStorage,i=p(t),a=i.findIndex(o=>o.id===s.id);a>-1&&i.splice(a,1),i.splice(0,0,s),e.setItem(t.key,JSON.stringify(i.length>5?i.slice(0,5):i))},p=s=>{if(!s.enabled||!s.key)return[];const e=(s.type==="localStorage"?localStorage:sessionStorage).getItem(s.key)||"";return x(e)},E=s=>{(s.type==="localStorage"?localStorage:sessionStorage).removeItem(s.key)},C=s=>typeof s=="string",A=(s,t,e)=>m(e||t,"{keyword}",s),g=async(s,t)=>{for(const e of t)try{const i=m(e,"{id}",s),a=await fetch(i);if(a.status===200){const o=await a.blob();return URL.createObjectURL(o)}}catch(i){console.error(i)}return""},m=(s,t,e)=>s.replace(new RegExp(t,"g"),e),d=(s,t,e)=>{s.forEach(i=>{i.classList.remove(e)}),s[t].classList.add(e)},L=s=>s.replace(/(<([^>]+)>)/gi,""),x=s=>{try{const t=JSON.parse(s);return Array.isArray(t)?t:[]}catch{return[]}};function W(s,t=0,{start:e=!0,middle:i=!0,once:a=!1}={}){let o=e,n=0,r,h=!1;function l(...u){if(h)return;const c=Date.now()-n;n=Date.now(),e&&i&&c>=t&&(o=!0),o?(o=!1,s.apply(this,u),a&&l.cancel()):(i&&c<t||!i)&&(clearTimeout(r),r=setTimeout(()=>{n=Date.now(),s.apply(this,u),a&&l.cancel()},i?t-c:t))}return l.cancel=()=>{clearTimeout(r),h=!0},l}function _(s,t=0,{start:e=!1,middle:i=!1,once:a=!1}={}){return W(s,t,{start:e,middle:i,once:a})}const I="https://c.qcc.com/embed/api/company/getCompanyName?searchKey={keyword}",q=async(s,t)=>{switch(t.api){case"qcc_openapi":return await D(s,t);default:return[]}},D=async(s,t)=>{if(s.length<2)return[];const e=A(s,I,t.searchUrl),a=await(await fetch(e,{method:"GET",mode:"cors",headers:{Referer:"https://c.qcc.com/"}})).json(),o=[];return a.status!=="200"?o:a.result.map(n=>({name:n.companyName,id:n.keyNo}))},H=(s,t)=>{let e=!1;document.addEventListener("click",i=>{!s.contains(i.target)&&!e&&t(),e=s.contains(i.target)},!0)},N=["https://image.qcc.com/logo/{id}.jpg","https://image.qcc.com/auto/{id}.jpg"],$=async(s,t)=>{const e=s.dataset.id||"";if(t.avatarUrl){s.src=await g(e,[t.avatarUrl]);return}switch(t.api){case"qcc_openapi":s.src=await g(e,N);break}};class T{constructor(t={}){this.suggestions=[],this.suggestionElement=document.createElement("div"),this.suggestionActivatedClassName="suggestion-popper--activated",this.inputWrapElement=document.createElement("div"),this.inputWrapHaveWordsClassName="company-autocomplete--words",this.inputWrapActivatedClassName="company-autocomplete--activated",this.options=Object.assign({},k,t),C(this.options.target)?this.target=document.querySelector(this.options.target):this.target=this.options.target,this.render()}render(){var a;if(!this.target)return;const t=[`<div class="company-autocomplete ${this.options.showSubmitButton?"company-autocomplete--show-submit":""}">`,'<div class="company-autocomplete__input">',`<input type="text" placeholder="${this.options.placeholder}" />`,this.options.clearable?`<div class="company-autocomplete__clear">${this.options.clearIcon}</div>`:"","</div>",this.options.showSubmitButton?'<div class="company-autocomplete__submit">':"",this.options.showSubmitButton?`<button type="button">${this.options.submitButtonLabel}</button>`:"",this.options.showSubmitButton?"</div>":"","</div>"];this.target.innerHTML=t.join(""),this.suggestionElement.classList.add("suggestion-popper"),this.clearSuggestion(),document.body.appendChild(this.suggestionElement),this.inputWrapElement=this.target.querySelector(".company-autocomplete");const e=this.inputWrapElement.querySelector("input"),i=this.inputWrapElement.querySelector("button");y(this.inputWrapElement,this.suggestionElement,()=>{v(this.inputWrapElement,this.suggestionElement,{middleware:[f(this.options.offsetTop),b({apply:({rects:o})=>{Object.assign(this.suggestionElement.style,{width:`${o.reference.width}px`})}}),...this.options.autoFlip?[S({fallbackPlacements:["top"]})]:[]]}).then(({x:o,y:n})=>{Object.assign(this.suggestionElement.style,{left:`${o}px`,top:`${n}px`})})}),e==null||e.addEventListener("input",()=>{this.keyboardActiveIndex=void 0,this.selectCompany=void 0;const o=e.value;this.inputWrapElement.classList[o.length>0?"add":"remove"](this.inputWrapHaveWordsClassName),o.length===0&&(this.clearSuggestion(),this.hideSuggestion())}),e==null||e.addEventListener("input",_(()=>{const o=e.value;o&&this.handleQuerySuggestion(o)},this.options.queryDelay)),e==null||e.addEventListener("click",o=>{if(this.suggestions.length>0){this.showSuggestion();return}const n=o.target.value;n?this.handleQuerySuggestion(n):this.options.history.enabled&&this.handleSuggestionDom(p(this.options.history),"history")}),i==null||i.addEventListener("click",()=>{this.handleSubmit(e.value)}),H(this.suggestionElement,()=>{this.hideSuggestion()}),this.suggestionElement.addEventListener("click",o=>{if(o.target.closest(".suggestion")){const n=o.target.closest(".suggestion"),r=(n==null?void 0:n.dataset.name)||"";e.value=r,this.suggestions=[],this.selectCompany={id:(n==null?void 0:n.dataset.id)||"",name:r},this.handleSelect(),this.hideSuggestion()}o.target.id==="remove-history-link"&&(E(this.options.history),this.clearSuggestion(),this.hideSuggestion())}),this.inputClearElement=this.inputWrapElement.querySelector(".company-autocomplete__clear"),this.inputClearElement&&((a=this.inputClearElement)==null||a.addEventListener("click",()=>{this.selectCompany=void 0,e.value="",this.clearSuggestion(),this.inputWrapElement.classList.remove(this.inputWrapHaveWordsClassName),this.options.onClear()})),this.options.autoFocus&&e.focus()}handleQuerySuggestion(t){q(t,this.options).then(e=>{this.handleSuggestionDom(e)})}handleSuggestionDom(t,e="fetch"){var a;if(this.suggestions=t,t.length===0){this.clearSuggestion(),this.hideSuggestion();return}const i=['<div class="suggestion-popper__body">'];t.forEach(o=>{const n=L(o.name);i.push(`<div class="suggestion" data-id="${o.id}" data-name="${n}">`),i.push(`<div class="suggestion__avatar"><img data-id="${o.id}" alt="${n}"/></div>`),i.push(`<div class="suggestion__label">${o.name}</div>`),i.push('<div class="suggestion__extra"></div>'),i.push("</div>")}),i.push("</div>"),i.push('<div class="suggestion-popper__footer">'),e==="history"&&((a=this.options.history)!=null&&a.showClear)&&t.length>0&&i.push('<a id="remove-history-link" href="javascript:;">删除历史</a>'),i.push("</div>"),this.suggestionElement.innerHTML=i.join(""),this.suggestionElement.querySelectorAll("img").forEach(o=>{$(o,this.options)}),this.showSuggestion(),this.options.onFetch()}handleSelect(){this.options.history.enabled&&this.selectCompany&&w(this.selectCompany,this.options.history),this.options.onSelect(this.selectCompany)}handleSubmit(t){this.options.submitCallback({company:this.selectCompany,text:t})}showSuggestion(){this.inputWrapElement.classList.add(this.inputWrapActivatedClassName),this.suggestionElement.classList.add(this.suggestionActivatedClassName),this.keyDownHandler&&this.inputWrapElement.removeEventListener("keydown",this.keyDownHandler),this.keyDownHandler=this.handleKeyDown.bind(this),this.inputWrapElement.addEventListener("keydown",this.keyDownHandler)}hideSuggestion(){this.inputWrapElement.classList.remove(this.inputWrapActivatedClassName),this.suggestionElement.classList.remove(this.suggestionActivatedClassName),this.inputWrapElement.removeEventListener("keydown",this.keyDownHandler)}clearSuggestion(){this.suggestionElement.textContent="",this.suggestions=[]}handleKeyDown(t){var e;switch(t.key){case"Enter":this.handleSubmit((e=t.target)==null?void 0:e.value);break;case"ArrowUp":this.keyboardActiveIndex?this.keyboardActiveIndex--:this.keyboardActiveIndex=this.suggestions.length-1,this.selectCompany=this.suggestions[this.keyboardActiveIndex],d(Array.from(this.suggestionElement.querySelectorAll(".suggestion")),this.keyboardActiveIndex,"suggestion--keyboard-active");break;case"ArrowDown":this.keyboardActiveIndex===void 0||this.keyboardActiveIndex>=this.suggestions.length-1?this.keyboardActiveIndex=0:this.keyboardActiveIndex++,this.selectCompany=this.suggestions[this.keyboardActiveIndex],d(Array.from(this.suggestionElement.querySelectorAll(".suggestion")),this.keyboardActiveIndex,"suggestion--keyboard-active");break}}}export{T as C};
