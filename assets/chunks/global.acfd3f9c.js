import{z as m,M as v,D as y,B as b,b as f}from"./floating-ui.dom.browser.min.876b4652.js";const E={target:"body",api:"qcc_openapi",queryDelay:500,placeholder:"请输入企业名称或统一社会信用代码",clearable:!0,clearIcon:'<svg viewBox="64 64 896 896" focusable="false" data-icon="close-circle" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm165.4 618.2l-66-.3L512 563.4l-99.3 118.4-66.1.3c-4.4 0-8-3.5-8-8 0-1.9.7-3.7 1.9-5.2l130.1-155L340.5 359a8.32 8.32 0 01-1.9-5.2c0-4.4 3.6-8 8-8l66.1.3L512 464.6l99.3-118.4 66-.3c4.4 0 8 3.5 8 8 0 1.9-.7 3.7-1.9 5.2L553.5 514l130 155c1.2 1.5 1.9 3.3 1.9 5.2 0 4.4-3.6 8-8 8z"></path></svg>',autoFocus:!0,onFetch:()=>{},onSelect:()=>{},onClear:()=>{},showSubmitButton:!0,submitButtonLabel:"Submit",offsetTop:5,autoFlip:!1,submitCallback:()=>{}},w=i=>typeof i=="string",k=(i,e,t)=>g(t||e,"{keyword}",i),p=async(i,e)=>{for(const t of e)try{const s=g(t,"{id}",i),o=await fetch(s);if(o.status===200){const n=await o.blob();return URL.createObjectURL(n)}}catch(s){console.error(s)}return""},g=(i,e,t)=>i.replace(new RegExp(e,"g"),t),d=(i,e,t)=>{i.forEach(s=>{s.classList.remove(t)}),i[e].classList.add(t)},S=i=>i.replace(/(<([^>]+)>)/gi,"");function C(i,e=0,{start:t=!0,middle:s=!0,once:o=!1}={}){let n=t,a=0,r,u=!1;function c(...h){if(u)return;const l=Date.now()-a;a=Date.now(),t&&s&&l>=e&&(n=!0),n?(n=!1,i.apply(this,h),o&&c.cancel()):(s&&l<e||!s)&&(clearTimeout(r),r=setTimeout(()=>{a=Date.now(),i.apply(this,h),o&&c.cancel()},s?e-l:e))}return c.cancel=()=>{clearTimeout(r),u=!0},c}function A(i,e=0,{start:t=!1,middle:s=!1,once:o=!1}={}){return C(i,e,{start:t,middle:s,once:o})}const L="https://c.qcc.com/embed/api/company/getCompanyName?searchKey={keyword}",x=async(i,e)=>{switch(e.api){case"qcc_openapi":return await W(i,e);default:return[]}},W=async(i,e)=>{if(i.length<2)return[];const t=k(i,L,e.searchUrl),o=await(await fetch(t,{method:"GET",mode:"cors",headers:{Referer:"https://c.qcc.com/"}})).json(),n=[];return o.status!=="200"?n:o.result.map(a=>({name:a.companyName,id:a.keyNo}))},_=(i,e)=>{let t=!1;document.addEventListener("click",s=>{!i.contains(s.target)&&!t&&e(),t=i.contains(s.target)},!0)},q=["https://image.qcc.com/logo/{id}.jpg","https://image.qcc.com/auto/{id}.jpg"],I=async(i,e)=>{const t=i.dataset.id||"";if(e.avatarUrl){i.src=await p(t,[e.avatarUrl]);return}switch(e.api){case"qcc_openapi":i.src=await p(t,q);break}};class ${constructor(e={}){this.suggestions=[],this.suggestionElement=document.createElement("div"),this.suggestionActivatedClassName="suggestion-popper--activated",this.inputWrapElement=document.createElement("div"),this.inputWrapHaveWordsClassName="company-autocomplete--words",this.inputWrapActivatedClassName="company-autocomplete--activated",this.options=Object.assign({},E,e),w(this.options.target)?this.target=document.querySelector(this.options.target):this.target=this.options.target,this.render()}render(){var o;if(!this.target)return;const e=[`<div class="company-autocomplete ${this.options.showSubmitButton?"company-autocomplete--show-submit":""}">`,'<div class="company-autocomplete__input">',`<input type="text" placeholder="${this.options.placeholder}" />`,this.options.clearable?`<div class="company-autocomplete__clear">${this.options.clearIcon}</div>`:"","</div>",this.options.showSubmitButton?'<div class="company-autocomplete__submit">':"",this.options.showSubmitButton?`<button type="button">${this.options.submitButtonLabel}</button>`:"",this.options.showSubmitButton?"</div>":"","</div>"];this.target.innerHTML=e.join(""),this.suggestionElement.classList.add("suggestion-popper"),this.suggestionElement.textContent="",document.body.appendChild(this.suggestionElement),this.inputWrapElement=this.target.querySelector(".company-autocomplete");const t=this.inputWrapElement.querySelector("input"),s=this.inputWrapElement.querySelector("button");m(this.inputWrapElement,this.suggestionElement,()=>{v(this.inputWrapElement,this.suggestionElement,{middleware:[y(this.options.offsetTop),b({apply:({rects:n})=>{Object.assign(this.suggestionElement.style,{width:`${n.reference.width}px`})}}),...this.options.autoFlip?[f({fallbackPlacements:["top"]})]:[]]}).then(({x:n,y:a})=>{Object.assign(this.suggestionElement.style,{left:`${n}px`,top:`${a}px`})})}),t==null||t.addEventListener("input",()=>{this.keyboardActiveIndex=void 0,this.selectCompany=void 0;const n=t.value;this.inputWrapElement.classList[n.length>0?"add":"remove"](this.inputWrapHaveWordsClassName),n.length===0&&this.hideSuggestion()}),t==null||t.addEventListener("input",A(()=>{const n=t.value;this.handleQuerySuggestion(n)},this.options.queryDelay)),t==null||t.addEventListener("click",n=>{if(this.suggestions.length>0){this.showSuggestion();return}const a=n.target.value;this.handleQuerySuggestion(a)}),s==null||s.addEventListener("click",()=>{this.handleSubmit(t.value)}),_(this.suggestionElement,()=>{this.hideSuggestion()}),this.suggestionElement.addEventListener("click",n=>{if(n.target.closest(".suggestion")){const a=n.target.closest(".suggestion"),r=(a==null?void 0:a.dataset.name)||"";t.value=r,this.suggestions=[],this.selectCompany={id:(a==null?void 0:a.dataset.id)||"",name:r},this.options.onSelect(this.selectCompany),this.hideSuggestion()}}),this.inputClearElement=this.inputWrapElement.querySelector(".company-autocomplete__clear"),this.inputClearElement&&((o=this.inputClearElement)==null||o.addEventListener("click",()=>{this.selectCompany=void 0,t.value="",this.suggestionElement.textContent="",this.inputWrapElement.classList.remove(this.inputWrapHaveWordsClassName),this.options.onClear()})),this.options.autoFocus&&t.focus()}handleQuerySuggestion(e){x(e,this.options).then(t=>{if(this.suggestions=t,t.length===0){this.suggestionElement.textContent="",this.hideSuggestion();return}const s=['<div class="suggestion-popper__body">'];t.forEach(o=>{const n=S(o.name);s.push(`<div class="suggestion" data-id="${o.id}" data-name="${n}">`),s.push(`<div class="suggestion__avatar"><img data-id="${o.id}" alt="${n}"/></div>`),s.push(`<div class="suggestion__label">${o.name}</div>`),s.push('<div class="suggestion__extra"></div>'),s.push("</div>")}),s.push("</div>"),s.push('<div class="suggestion-popper__footer">'),s.push("</div>"),this.suggestionElement.innerHTML=s.join(""),this.suggestionElement.querySelectorAll("img").forEach(o=>{I(o,this.options)}),this.showSuggestion(),this.options.onFetch()})}handleSubmit(e){this.options.submitCallback({company:this.selectCompany,text:e})}showSuggestion(){this.inputWrapElement.classList.add(this.inputWrapActivatedClassName),this.suggestionElement.classList.add(this.suggestionActivatedClassName),this.keyDownHandler&&this.inputWrapElement.removeEventListener("keydown",this.keyDownHandler),this.keyDownHandler=this.handleKeyDown.bind(this),this.inputWrapElement.addEventListener("keydown",this.keyDownHandler)}hideSuggestion(){this.inputWrapElement.classList.remove(this.inputWrapActivatedClassName),this.suggestionElement.classList.remove(this.suggestionActivatedClassName),this.inputWrapElement.removeEventListener("keydown",this.keyDownHandler)}handleKeyDown(e){var t;switch(e.key){case"Enter":this.handleSubmit((t=e.target)==null?void 0:t.value);break;case"ArrowUp":this.keyboardActiveIndex?this.keyboardActiveIndex--:this.keyboardActiveIndex=this.suggestions.length-1,this.selectCompany=this.suggestions[this.keyboardActiveIndex],d(Array.from(this.suggestionElement.querySelectorAll(".suggestion")),this.keyboardActiveIndex,"suggestion--keyboard-active");break;case"ArrowDown":this.keyboardActiveIndex===void 0||this.keyboardActiveIndex>=this.suggestions.length-1?this.keyboardActiveIndex=0:this.keyboardActiveIndex++,this.selectCompany=this.suggestions[this.keyboardActiveIndex],d(Array.from(this.suggestionElement.querySelectorAll(".suggestion")),this.keyboardActiveIndex,"suggestion--keyboard-active");break}}}export{$ as C};
